<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizMania - Sistema Real</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
            overflow-x: hidden;
        }

        /* Animação de fundo fluido */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Partículas flutuantes no fundo */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255,255,255,0.1) 1px, transparent 1px),
                radial-gradient(circle at 80% 80%, rgba(255,255,255,0.1) 1px, transparent 1px),
                radial-gradient(circle at 40% 40%, rgba(255,255,255,0.05) 2px, transparent 2px);
            background-size: 50px 50px, 80px 80px, 120px 120px;
            animation: float 20s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes float {
            0% { transform: translateY(0px) translateX(0px); }
            50% { transform: translateY(-20px) translateX(10px); }
            100% { transform: translateY(0px) translateX(0px); }
        }

        /* Temas - Versões mais animadas */
        body.theme-space {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 30%, #16213e 60%, #0f3460 100%);
            background-size: 400% 400%;
            animation: spaceShift 20s ease infinite;
        }

        @keyframes spaceShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        body.theme-space::before {
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.2) 1px, transparent 1px),
                radial-gradient(circle at 75% 75%, rgba(100,200,255,0.1) 2px, transparent 2px),
                radial-gradient(circle at 50% 50%, rgba(255,255,255,0.05) 1px, transparent 1px);
            animation: twinkle 5s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        body.theme-nature {
            background: linear-gradient(135deg, #134e5e 0%, #71b280 50%, #a8e6cf 100%);
            background-size: 400% 400%;
            animation: natureFlow 18s ease infinite;
        }

        @keyframes natureFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        body.theme-sunset {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 30%, #ff9a9e 60%, #fad0c4 100%);
            background-size: 400% 400%;
            animation: sunsetGlow 12s ease infinite;
        }

        @keyframes sunsetGlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 800px;
            width: 90%;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            box-shadow: 
                0 25px 50px rgba(0,0,0,0.2),
                0 0 0 1px rgba(255,255,255,0.1),
                inset 0 1px 0 rgba(255,255,255,0.2);
            overflow: hidden;
            position: relative;
            z-index: 1;
            animation: containerEntry 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-origin: center;
        }

        @keyframes containerEntry {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(100px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 400% 400%;
            animation: headerGradient 8s ease infinite;
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        @keyframes headerGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 70%, rgba(255,255,255,0.1) 0%, transparent 50%);
            animation: headerPulse 4s ease-in-out infinite;
        }

        @keyframes headerPulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            font-weight: 800;
            text-shadow: 
                0 0 20px rgba(255,255,255,0.5),
                0 0 40px rgba(255,255,255,0.3),
                0 2px 4px rgba(0,0,0,0.3);
            animation: titleFloat 3s ease-in-out infinite;
            position: relative;
            z-index: 1;
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
            font-weight: 500;
            position: relative;
            z-index: 1;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .content {
            padding: 40px;
            color: #333 !important;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(102, 126, 234, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        /* CORREÇÃO DAS FONTES - Garantir visibilidade em todos os temas */
        .content h2,
        .content h3,
        .content p,
        .content span,
        .content div {
            color: #333 !important;
        }

        .screen {
            display: none;
            animation: screenFadeIn 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .screen.active {
            display: block;
        }

        @keyframes screenFadeIn {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2, #667eea);
            background-size: 200% 200%;
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 30px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin: 12px;
            box-shadow: 
                0 8px 25px rgba(102, 126, 234, 0.3),
                0 0 0 1px rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 15px 35px rgba(102, 126, 234, 0.4),
                0 0 0 1px rgba(255,255,255,0.2);
            background-position: 100% 0;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: translateY(-1px) scale(0.98);
        }

        .btn-large {
            padding: 25px 45px;
            font-size: 1.4em;
            display: block;
            width: 100%;
            margin: 25px 0;
            border-radius: 35px;
            box-shadow: 
                0 12px 35px rgba(102, 126, 234, 0.3),
                0 0 0 1px rgba(255,255,255,0.1);
        }

        .input-group {
            margin: 25px 0;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 700;
            color: #333 !important;
            font-size: 1.1em;
            text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        }

        .input-group input, .input-group textarea, .input-group select {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 15px;
            font-size: 1.1em;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            color: #333 !important;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            box-shadow: 
                0 4px 15px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .input-group input:focus, .input-group textarea:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 1);
            box-shadow: 
                0 8px 25px rgba(102, 126, 234, 0.2),
                0 0 0 3px rgba(102, 126, 234, 0.1),
                inset 0 1px 0 rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .question-item {
            background: #f8f9fa;
            padding: 20px;
            margin: 15px 0;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            color: #333 !important;
            position: relative;
        }

        .question-item .delete-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .question-item .delete-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .question-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .question-image-game {
            max-width: 100%;
            max-height: 300px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            display: block;
            margin-left: auto;
            margin-right: auto;
            border: 3px solid rgba(255,255,255,0.2);
            animation: imageSlideIn 0.6s ease;
        }

        @keyframes imageSlideIn {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .participant-avatar {
            font-size: 1.8em;
            margin-right: 15px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .results {
            margin: 25px 0;
            color: #333 !important;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(15px);
            padding: 20px 25px;
            margin: 15px 0;
            border-radius: 18px;
            border-left: 6px solid #27ae60;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #333 !important;
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.08),
                inset 0 1px 0 rgba(255,255,255,0.2);
            animation: resultSlideIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transition: all 0.3s ease;
        }

        @keyframes resultSlideIn {
            0% { 
                opacity: 0; 
                transform: translateY(30px) scale(0.9); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        .result-item:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 15px 35px rgba(0,0,0,0.12),
                inset 0 1px 0 rgba(255,255,255,0.3);
        }

        .score {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 1.1em;
            box-shadow: 
                0 4px 15px rgba(39, 174, 96, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.2);
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        /* Timer - Versão Futurística */
        .timer-container {
            text-align: center;
            margin: 30px 0;
            position: relative;
        }

        .timer-container p {
            color: #333 !important;
            font-weight: 600;
            font-size: 1.1em;
            margin-top: 15px;
            text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        }

        .timer {
            display: inline-block;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(#ff6b6b 0deg, #ddd 0deg);
            position: relative;
            margin: 0 auto;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.2),
                inset 0 0 0 8px rgba(255,255,255,0.1),
                inset 0 0 0 12px rgba(255,255,255,0.05);
            animation: timerPulse 2s ease-in-out infinite;
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .timer::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
            backdrop-filter: blur(10px);
        }

        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5em;
            font-weight: 900;
            color: #333;
            text-shadow: 0 2px 4px rgba(255,255,255,0.8);
            z-index: 2;
        }

        .timer.urgent {
            animation: timerUrgent 0.5s infinite;
            box-shadow: 
                0 10px 30px rgba(255,107,107,0.4),
                0 0 20px rgba(255,107,107,0.6),
                inset 0 0 0 8px rgba(255,255,255,0.2),
                inset 0 0 0 12px rgba(255,107,107,0.1);
        }

        @keyframes timerUrgent {
            0%, 100% { 
                transform: scale(1);
                filter: brightness(1);
            }
            50% { 
                transform: scale(1.05);
                filter: brightness(1.2);
            }
        }

        /* Avatares */
        .avatar-selection {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .avatar-option {
            aspect-ratio: 1;
            border: 3px solid #ddd;
            border-radius: 50%;
            cursor: pointer;
            font-size: 2em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .avatar-option:hover {
            transform: scale(1.1);
        }

        .avatar-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        /* Temas */
        .theme-selection {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .theme-option {
            padding: 20px;
            border: 3px solid #ddd;
            border-radius: 15px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .theme-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .theme-default { background: linear-gradient(45deg, #667eea, #764ba2); color: white; }
        .theme-space { background: linear-gradient(45deg, #0c0c0c, #1a1a2e); color: white; }
        .theme-nature { background: linear-gradient(45deg, #134e5e, #71b280); color: white; }
        .theme-sunset { background: linear-gradient(45deg, #fa709a, #fee140); color: white; }

        .answers-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .answers-grid.true-false {
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            max-width: 600px;
            margin: 30px auto;
        }

        .answer-option {
            padding: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            cursor: pointer;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-weight: 700;
            font-size: 1.1em;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.15),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .answer-option.true-false {
            padding: 30px 20px;
            font-size: 1.3em;
            border-radius: 25px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .answer-option.true-false .tf-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .answer-option.true-false .tf-text {
            font-size: 1.2em;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Estilos para seleção de Verdadeiro/Falso no formulário */
        input[name="tfCorrect"]:checked + span {
            color: #fff !important;
        }

        input[name="tfCorrect"]:checked {
            accent-color: #667eea;
        }

        label:has(input[name="tfCorrect"]:checked) {
            background: linear-gradient(135deg, #667eea, #764ba2) !important;
            border-color: #667eea !important;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        label:has(input[name="tfCorrect"]) {
            transition: all 0.3s ease;
        }

        label:has(input[name="tfCorrect"]):hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .answer-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .answer-a { 
            background: linear-gradient(135deg, #ff6b6b, #ff8a80);
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .answer-b { 
            background: linear-gradient(135deg, #4ecdc4, #80e7d1);
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .answer-c { 
            background: linear-gradient(135deg, #45b7d1, #64b5f6);
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .answer-d { 
            background: linear-gradient(135deg, #96ceb4, #a5d6a7);
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .answer-option:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: 
                0 20px 40px rgba(0,0,0,0.2),
                0 0 0 3px rgba(255,255,255,0.3),
                inset 0 1px 0 rgba(255,255,255,0.4);
            border-color: rgba(255,255,255,0.6);
        }

        .answer-option:hover::before {
            left: 100%;
        }

        .answer-option.selected {
            border: 4px solid #fff;
            transform: translateY(-8px) scale(1.05);
            box-shadow: 
                0 25px 50px rgba(0,0,0,0.3),
                0 0 30px rgba(255,255,255,0.6),
                inset 0 1px 0 rgba(255,255,255,0.4);
            animation: selectedPulse 0.6s ease;
        }

        @keyframes selectedPulse {
            0% { transform: translateY(-8px) scale(1.05); }
            50% { transform: translateY(-12px) scale(1.08); }
            100% { transform: translateY(-8px) scale(1.05); }
        }

        .answer-option.correct {
            background: linear-gradient(135deg, #27ae60, #2ecc71) !important;
            animation: correctAnswer 1s ease;
            border-color: #fff !important;
        }

        .answer-option.incorrect {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
            animation: incorrectShake 0.8s ease;
            border-color: #fff !important;
        }

        @keyframes correctAnswer {
            0% { transform: translateY(-8px) scale(1.05); }
            25% { transform: translateY(-15px) scale(1.1) rotateZ(5deg); }
            50% { transform: translateY(-20px) scale(1.15) rotateZ(-5deg); }
            75% { transform: translateY(-15px) scale(1.1) rotateZ(3deg); }
            100% { transform: translateY(-8px) scale(1.05) rotateZ(0deg); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateY(-8px) translateX(0) scale(1.05); }
            10% { transform: translateY(-8px) translateX(-15px) scale(1.05); }
            20% { transform: translateY(-8px) translateX(15px) scale(1.05); }
            30% { transform: translateY(-8px) translateX(-15px) scale(1.05); }
            40% { transform: translateY(-8px) translateX(15px) scale(1.05); }
            50% { transform: translateY(-8px) translateX(-10px) scale(1.05); }
            60% { transform: translateY(-8px) translateX(10px) scale(1.05); }
            70% { transform: translateY(-8px) translateX(-5px) scale(1.05); }
            80% { transform: translateY(-8px) translateX(5px) scale(1.05); }
        }

        .game-code {
            background: linear-gradient(135deg, #ffffff, #f8f9fa, #ffffff);
            color: #2c3e50;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            margin: 25px 0;
            box-shadow: 
                0 20px 40px rgba(0,0,0,0.15),
                0 0 0 3px rgba(52, 152, 219, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.8);
            border: 3px solid #e3f2fd;
            animation: codeGlow 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .game-code::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(52, 152, 219, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(102, 126, 234, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        @keyframes codeGlow {
            0%, 100% { 
                box-shadow: 
                    0 20px 40px rgba(0,0,0,0.15),
                    0 0 0 3px rgba(52, 152, 219, 0.2),
                    inset 0 1px 0 rgba(255,255,255,0.8);
                border-color: #e3f2fd;
            }
            50% { 
                box-shadow: 
                    0 25px 50px rgba(0,0,0,0.2),
                    0 0 0 4px rgba(52, 152, 219, 0.4),
                    0 0 30px rgba(52, 152, 219, 0.2),
                    inset 0 1px 0 rgba(255,255,255,0.9);
                border-color: #bbdefb;
            }
        }

        .game-code .code {
            font-size: 4.5em;
            font-weight: 900;
            letter-spacing: 15px;
            color: #1a1a1a;
            text-shadow: 
                0 2px 4px rgba(0,0,0,0.1),
                0 0 10px rgba(52, 152, 219, 0.3);
            animation: codeFloat 4s ease-in-out infinite;
            position: relative;
            z-index: 2;
            background: linear-gradient(45deg, #1a1a1a, #2c3e50, #1a1a1a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 10px 0;
        }

        @keyframes codeFloat {
            0%, 100% { 
                transform: translateY(0px) scale(1);
            }
            50% { 
                transform: translateY(-5px) scale(1.01);
            }
        }

        /* QR Code Section - Estilo Futurístico */
        .qr-code-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 25px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
            box-shadow: 
                0 15px 35px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.2);
            animation: qrSectionEntry 0.8s ease;
        }

        @keyframes qrSectionEntry {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .qr-code-section h3 {
            color: #333 !important;
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        }

        .qr-code-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .qr-code-wrapper {
            position: relative;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.1),
                0 0 0 3px rgba(102, 126, 234, 0.2),
                inset 0 1px 0 rgba(255,255,255,0.8);
            border: 2px solid #e3f2fd;
            animation: qrGlow 3s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes qrGlow {
            0%, 100% {
                box-shadow: 
                    0 10px 30px rgba(0,0,0,0.1),
                    0 0 0 3px rgba(102, 126, 234, 0.2),
                    inset 0 1px 0 rgba(255,255,255,0.8);
                border-color: #e3f2fd;
            }
            50% {
                box-shadow: 
                    0 15px 40px rgba(0,0,0,0.15),
                    0 0 0 4px rgba(102, 126, 234, 0.4),
                    0 0 20px rgba(102, 126, 234, 0.2),
                    inset 0 1px 0 rgba(255,255,255,0.9);
                border-color: #bbdefb;
            }
        }

        #qrCodeImage {
            width: 170px;
            height: 170px;
            border-radius: 10px;
            animation: qrFadeIn 0.6s ease;
        }

        @keyframes qrFadeIn {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .qr-loading {
            width: 170px;
            height: 170px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #667eea;
            font-weight: 600;
        }

        .qr-instructions {
            color: #333 !important;
            font-size: 1.1em;
            font-weight: 600;
            text-align: center;
            line-height: 1.6;
            max-width: 300px;
            margin: 0 auto;
        }

        .qr-instructions strong {
            color: #667eea !important;
        }

        .qr-instructions small {
            color: #666 !important;
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* Layout das opções na criação de perguntas */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .option-input {
            position: relative;
            border-radius: 18px;
            padding: 25px 20px 20px 20px;
            border: 3px solid rgba(255,255,255,0.4);
            backdrop-filter: blur(10px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.15),
                inset 0 1px 0 rgba(255,255,255,0.2);
            overflow: hidden;
        }

        .option-input::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .option-input:hover::before {
            left: 100%;
        }

        .option-input label {
            position: absolute;
            top: -15px;
            left: 25px;
            background: inherit;
            padding: 8px 18px;
            border-radius: 25px;
            font-weight: 900;
            font-size: 1.2em;
            color: white !important;
            text-shadow: 0 2px 4px rgba(0,0,0,0.4);
            border: 2px solid rgba(255,255,255,0.4);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 2;
        }

        .option-input input {
            width: 100%;
            border: none;
            background: rgba(255,255,255,0.95);
            padding: 18px;
            border-radius: 12px;
            font-size: 1.05em;
            font-weight: 600;
            color: #333 !important;
            box-shadow: 
                inset 0 3px 8px rgba(0,0,0,0.1),
                0 0 0 2px rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }

        .option-input input:focus {
            background: rgba(255,255,255,1);
            box-shadow: 
                inset 0 3px 8px rgba(0,0,0,0.1),
                0 0 0 3px rgba(255,255,255,0.4),
                0 5px 20px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .option-input input::placeholder {
            color: #666;
            font-weight: 500;
        }

        /* Cores das opções seguindo o padrão do quiz */
        .option-a {
            background: linear-gradient(135deg, #ff6b6b, #ff8a80);
        }

        .option-b {
            background: linear-gradient(135deg, #4ecdc4, #80e7d1);
        }

        .option-c {
            background: linear-gradient(135deg, #45b7d1, #64b5f6);
        }

        .option-d {
            background: linear-gradient(135deg, #96ceb4, #a5d6a7);
        }

        .option-input:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 15px 35px rgba(0,0,0,0.2),
                0 0 0 4px rgba(255,255,255,0.5),
                inset 0 1px 0 rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.6);
        }

        /* Animação para tooltip do QR Code */
        @keyframes tooltipFade {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(10px);
            }
            20%, 80% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px);
            }
        }

        .participants {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            color: #333 !important;
        }

        .participants h3 {
            color: #333 !important;
        }

        .participant-item {
            background: white;
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #333 !important;
        }

        .participant-avatar {
            font-size: 1.5em;
            margin-right: 10px;
        }

        .results {
            margin: 20px 0;
            color: #333 !important;
        }

        .result-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 5px solid #27ae60;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideIn 0.5s ease;
            color: #333 !important;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .score {
            background: #27ae60;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .live-ranking {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(78, 205, 196, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
            color: #333 !important;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.2);
            animation: rankingEntry 0.6s ease;
        }

        @keyframes rankingEntry {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.9);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .live-ranking h3 {
            color: #333 !important;
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
        }

        .ranking-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            color: #333 !important;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.2);
            animation: rankingItemSlide 0.5s ease;
        }

        @keyframes rankingItemSlide {
            0% {
                opacity: 0;
                transform: translateX(-30px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .ranking-item:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .status-indicator {
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            margin: 20px 0;
            color: #333 !important;
        }

        .status-waiting { background: #fff3cd; border: 2px solid #ffc107; }
        .status-playing { background: #d4edda; border: 2px solid #28a745; }
        .status-error { background: #f8d7da; border: 2px solid #dc3545; }

        /* Status de conexão discreto - Versão Futurística */
        .connection-status {
            position: fixed;
            top: 20px;
            right: 80px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            z-index: 1000;
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            animation: statusFloat 3s ease-in-out infinite;
        }

        @keyframes statusFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        /* Controle de som - Versão Futurística */
        .sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            z-index: 1000;
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.2);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            color: #28a745;
            animation: soundFloat 3s ease-in-out infinite 0.5s;
        }

        @keyframes soundFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .sound-toggle:hover {
            transform: translateY(-3px) scale(1.1);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 
                0 12px 35px rgba(0,0,0,0.15),
                0 0 20px rgba(40, 167, 69, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.3);
        }

        .sound-toggle.muted {
            color: #dc3545;
        }

        .sound-toggle.muted:hover {
            box-shadow: 
                0 12px 35px rgba(0,0,0,0.15),
                0 0 20px rgba(220, 53, 69, 0.3),
                inset 0 1px 0 rgba(255,255,255,0.3);
        }

        /* Área secreta para modo professor */
        .secret-area {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 80px;
            height: 80px;
            z-index: 999;
            cursor: default;
            background: transparent;
            border-radius: 0 50px 0 0;
            transition: all 0.3s ease;
        }

        /* Feedback visual discreto quando clicando na área secreta */
        .secret-area.clicking {
            background: rgba(102, 126, 234, 0.1);
            backdrop-filter: blur(10px);
        }

        .connection-status.connected {
            color: #28a745;
        }

        .connection-status.connecting {
            color: #ffc107;
            animation: spin 1s linear infinite;
        }

        .connection-status.error {
            color: #dc3545;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Indicador de respostas */
        .answers-status {
            background: #e9ecef;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            transition: all 0.3s ease;
            color: #333 !important;
        }

        .answers-status p {
            color: #333 !important;
        }

        .answers-status.all-answered {
            background: #d4edda;
            border: 2px solid #28a745;
            animation: pulse-success 0.6s ease;
        }

        @keyframes pulse-success {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .answers-progress {
            background: #dee2e6;
            border-radius: 10px;
            height: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .answers-progress-bar {
            background: linear-gradient(45deg, #28a745, #20c997);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        /* Área do professor */
        .teacher-panel {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            color: #333 !important;
        }

        .teacher-panel h3 {
            color: #333 !important;
        }

        /* Confete - Versão Melhorada */
        .confetti {
            position: fixed;
            width: 12px;
            height: 12px;
            background: #ff6b6b;
            top: -20px;
            animation: confetti-fall 4s linear forwards;
            z-index: 1000;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255,107,107,0.5);
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg) scale(1);
                opacity: 1;
            }
            50% {
                opacity: 1;
                transform: translateY(20vh) rotate(720deg) scale(1.2);
            }
            100% {
                transform: translateY(100vh) rotate(1080deg) scale(0.5);
                opacity: 0;
            }
        }

        .loading {
            text-align: center;
            padding: 25px;
            color: #333 !important;
            font-size: 1.1em;
            font-weight: 600;
        }

        .loading::after {
            content: "⏳";
            animation: loadingSpin 1.5s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }

        @keyframes loadingSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Elementos específicos importantes */
        #gameTitle,
        #currentQuestionNum,
        #totalQuestions,
        #currentQuestion {
            color: #333 !important;
            font-weight: bold;
        }

        #playerDisplayName {
            color: #333 !important;
        }

        /* Rede de segurança final para garantir visibilidade */
        .container .content *:not(.btn):not(.answer-option):not(.score):not(.header):not(.game-code) {
            color: #333 !important;
        }

        @media (max-width: 600px) {
            .answers-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .answers-grid.true-false {
                grid-template-columns: 1fr;
                gap: 20px;
                max-width: 100%;
                margin: 20px auto;
            }

            .answer-option.true-false {
                padding: 25px 15px;
                font-size: 1.1em;
                min-height: 80px;
            }

            .answer-option.true-false .tf-icon {
                font-size: 2em;
                margin-bottom: 8px;
            }

            .answer-option.true-false .tf-text {
                font-size: 1.1em;
                letter-spacing: 1px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .game-code .code {
                font-size: 2.2em;
            }

            .avatar-selection {
                grid-template-columns: repeat(3, 1fr);
            }

            .theme-selection {
                grid-template-columns: 1fr;
            }

            .connection-status {
                top: 15px;
                right: 70px;
                width: 45px;
                height: 45px;
                font-size: 1.1em;
            }

            .sound-toggle {
                top: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
                font-size: 1.1em;
            }

            .container {
                width: 95%;
                margin: 10px;
            }

            .content {
                padding: 25px;
            }

            .header {
                padding: 30px 20px;
            }

            .timer {
                width: 100px;
                height: 100px;
            }

            .timer-text {
                font-size: 2em;
            }

            .answer-option {
                padding: 18px;
                font-size: 1em;
            }

            .btn-large {
                padding: 20px 35px;
                font-size: 1.2em;
            }

            /* Reduzir animações em dispositivos móveis para melhor performance */
            * {
                animation-duration: 0.3s !important;
            }

            body::before {
                animation: none;
            }

            /* QR Code responsivo */
            .qr-code-wrapper {
                width: 160px;
                height: 160px;
                padding: 10px;
            }

            #qrCodeImage, .qr-loading {
                width: 140px;
                height: 140px;
            }

            .qr-code-section {
                padding: 20px;
                margin: 20px 0;
            }

            .qr-instructions {
                font-size: 1em;
            }

            /* Área secreta responsiva */
            .secret-area {
                width: 70px;
                height: 70px;
            }

            /* Layout responsivo das opções de criação */
            .options-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 10px;
                margin-top: 15px;
            }

            .option-input {
                padding: 20px 15px 15px 15px;
            }

            .option-input label {
                font-size: 1.1em;
                padding: 6px 15px;
                top: -12px;
                left: 20px;
            }

            .option-input input {
                padding: 15px;
                font-size: 1em;
            }

            /* Imagens responsivas */
            .question-image {
                max-height: 150px;
            }

            .question-image-game {
                max-height: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- Status de conexão discreto -->
    <div class="connection-status connecting" id="connectionStatus" title="Conectando...">
        🌐
    </div>

    <!-- Controle de som -->
    <button class="sound-toggle" id="soundToggle" title="Ativar/Desativar Sons" onclick="toggleSound()">
        🔊
    </button>

    <!-- Área secreta para modo professor (canto inferior esquerdo) -->
    <div class="secret-area" id="secretArea" title=""></div>

    <div class="container">
        <div class="header">
            <h1>🎮 QuizMania</h1>
            <p>Pronto para o desafio?</p>
        </div>

        <!-- Tela Inicial -->
        <div class="screen active" id="homeScreen">
            <div class="content">
                <h2>Bem-vindo ao QuizMania!</h2>
                <p>Entre com o código da sala para participar:</p>
                
                <button class="btn btn-large" onclick="showScreen('joinScreen')">
                    🎯 Participar do Quiz
                </button>
            </div>
        </div>

        <!-- Criar Quiz (oculto por padrão) -->
        <div class="screen" id="createScreen">
            <div class="content">
                <h2>🏫 Painel do Professor</h2>
                
                <div class="teacher-panel">
                    <h3>Criar Novo Quiz</h3>
                    
                    <div class="input-group">
                        <label>Nome do Quiz:</label>
                        <input type="text" id="quizTitle" placeholder="Ex: Quiz de História">
                    </div>

                    <div class="input-group">
                        <label>Tempo por Pergunta:</label>
                        <select id="timeLimit">
                            <option value="5">5 segundos ⚡</option>
                            <option value="10">10 segundos 🕐</option>
                            <option value="20" selected>20 segundos 🕑</option>
                            <option value="30">30 segundos 🕒</option>
                            <option value="45">45 segundos 🕓</option>
                            <option value="60">1 minuto 🕔</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Tipo de Pergunta:</label>
                        <select id="questionType" onchange="toggleQuestionType()">
                            <option value="multiple">🔤 Múltipla Escolha (A, B, C, D)</option>
                            <option value="truefalse">✅ Verdadeiro ou Falso</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Pergunta:</label>
                        <textarea id="questionText" placeholder="Digite sua pergunta aqui..." rows="3"></textarea>
                    </div>

                    <!-- Campo opcional para imagem -->
                    <div class="input-group">
                        <label>Imagem (opcional): 🖼️</label>
                        <input type="url" id="questionImage" placeholder="Cole o link da imagem aqui... (ex: https://exemplo.com/imagem.jpg)">
                        <small style="color: #666; margin-top: 8px; display: block; line-height: 1.4;">
                            💡 <strong>Dicas para encontrar imagens:</strong><br>
                            • <strong>Google Imagens:</strong> Clique com botão direito → "Copiar endereço da imagem"<br>
                            • <strong>Sites recomendados:</strong> imgur.com, postimg.cc, ou Google Drive público<br>
                            • <strong>Formatos aceitos:</strong> .jpg, .png, .gif, .webp
                        </small>
                    </div>

                    <!-- Opções para Múltipla Escolha -->
                    <div class="input-group" id="multipleChoiceOptions">
                        <label>Alternativas de Resposta:</label>
                        <div class="options-grid">
                            <div class="option-input option-a">
                                <label>A</label>
                                <input type="text" id="optionA" placeholder="Primeira opção">
                            </div>
                            <div class="option-input option-b">
                                <label>B</label>
                                <input type="text" id="optionB" placeholder="Segunda opção">
                            </div>
                            <div class="option-input option-c">
                                <label>C</label>
                                <input type="text" id="optionC" placeholder="Terceira opção">
                            </div>
                            <div class="option-input option-d">
                                <label>D</label>
                                <input type="text" id="optionD" placeholder="Quarta opção">
                            </div>
                        </div>
                    </div>

                    <div class="input-group" id="multipleChoiceCorrect">
                        <label>Resposta Correta:</label>
                        <select id="correctAnswer">
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                        </select>
                    </div>

                    <!-- Opções para Verdadeiro/Falso -->
                    <div class="input-group" id="trueFalseCorrect" style="display: none;">
                        <label>Resposta Correta:</label>
                        <div style="display: flex; gap: 20px; justify-content: center; margin-top: 15px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 15px 25px; background: rgba(40, 167, 69, 0.1); border: 2px solid rgba(40, 167, 69, 0.3); border-radius: 15px; transition: all 0.3s ease;">
                                <input type="radio" name="tfCorrect" value="true" id="correctTrue" style="transform: scale(1.2);">
                                <span style="font-size: 1.1em; font-weight: 600; color: #28a745;">✅ Verdadeiro</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 15px 25px; background: rgba(220, 53, 69, 0.1); border: 2px solid rgba(220, 53, 69, 0.3); border-radius: 15px; transition: all 0.3s ease;">
                                <input type="radio" name="tfCorrect" value="false" id="correctFalse" style="transform: scale(1.2);">
                                <span style="font-size: 1.1em; font-weight: 600; color: #dc3545;">❌ Falso</span>
                            </label>
                        </div>
                    </div>

                    <button class="btn" onclick="addQuestion()" id="addQuestionBtn">➕ Adicionar Pergunta</button>
                    
                    <div id="questionsList"></div>

                    <button class="btn btn-large" onclick="createRoom()" id="createBtn" style="display: none;">
                        🚀 Criar Sala do Quiz
                    </button>
                </div>

                <button class="btn" onclick="showScreen('homeScreen')">← Voltar</button>
            </div>
        </div>

        <!-- Sala de Espera do Professor -->
        <div class="screen" id="waitingScreen">
            <div class="content">
                <h2>🏫 Sala de Espera - Professor</h2>
                
                <div class="game-code">
                    <p>Código da Sala:</p>
                    <div class="code" id="roomCode">------</div>
                    <p>Compartilhe este código com seus alunos!</p>
                </div>

                <!-- QR Code Section -->
                <div class="qr-code-section">
                    <h3>📱 QR Code para Entrada Rápida</h3>
                    <div class="qr-code-container">
                        <div class="qr-code-wrapper">
                            <img id="qrCodeImage" src="" alt="QR Code" style="display: none;">
                            <div class="qr-loading" id="qrLoading">
                                <div class="loading">Gerando QR Code</div>
                            </div>
                        </div>
                        <p class="qr-instructions">
                            🎯 <strong>Alunos:</strong> Escaneiem com a câmera do celular!<br>
                            <small>Entrada automática na sala</small>
                        </p>
                    </div>
                </div>

                <div class="participants">
                    <h3>👥 Participantes Conectados:</h3>
                    <div id="participantsList">
                        <div class="loading">Aguardando participantes</div>
                    </div>
                </div>

                <button class="btn btn-large" onclick="startGame()" id="startGameBtn">
                    ▶️ Começar Quiz
                </button>

                <button class="btn" onclick="leaveRoom()">← Sair da Sala</button>
            </div>
        </div>

        <!-- Participar -->
        <div class="screen" id="joinScreen">
            <div class="content">
                <h2>Participar do Quiz</h2>
                
                <div class="input-group">
                    <label>Seu Nome:</label>
                    <input type="text" id="playerName" placeholder="Digite seu nome">
                </div>

                <div class="input-group">
                    <label>Código da Sala:</label>
                    <input type="text" id="roomCodeInput" placeholder="Digite o código da sala">
                </div>

                <button class="btn btn-large" onclick="showPersonalization()">
                    🎯 Continuar
                </button>

                <button class="btn" onclick="showScreen('homeScreen')">← Voltar</button>
            </div>
        </div>

        <!-- Personalização -->
        <div class="screen" id="personalizationScreen">
            <div class="content">
                <h2>🎨 Personalize seu Perfil</h2>
                
                <div class="input-group">
                    <label>Escolha seu Avatar:</label>
                    <div class="avatar-selection">
                        <div class="avatar-option selected" data-avatar="🧑‍🎓">🧑‍🎓</div>
                        <div class="avatar-option" data-avatar="👨‍💼">👨‍💼</div>
                        <div class="avatar-option" data-avatar="👩‍💼">👩‍💼</div>
                        <div class="avatar-option" data-avatar="🧑‍💻">🧑‍💻</div>
                        <div class="avatar-option" data-avatar="👨‍🔬">👨‍🔬</div>
                        <div class="avatar-option" data-avatar="👩‍🔬">👩‍🔬</div>
                        <div class="avatar-option" data-avatar="🧑‍🚀">🧑‍🚀</div>
                        <div class="avatar-option" data-avatar="🤖">🤖</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Escolha o Tema:</label>
                    <div class="theme-selection">
                        <div class="theme-option theme-default selected" data-theme="default">
                            <strong>🌈 Padrão</strong><br>
                            <small>Clássico</small>
                        </div>
                        <div class="theme-option theme-space" data-theme="space">
                            <strong>🚀 Espacial</strong><br>
                            <small>Galáxia</small>
                        </div>
                        <div class="theme-option theme-nature" data-theme="nature">
                            <strong>🌿 Natureza</strong><br>
                            <small>Verde</small>
                        </div>
                        <div class="theme-option theme-sunset" data-theme="sunset">
                            <strong>🌅 Pôr do Sol</strong><br>
                            <small>Vibrante</small>
                        </div>
                    </div>
                </div>

                <button class="btn btn-large" onclick="joinRoom()">
                    ✨ Entrar na Sala!
                </button>
            </div>
        </div>

        <!-- Aguardando Início -->
        <div class="screen" id="playerWaitingScreen">
            <div class="content">
                <h2>🎯 Conectado na Sala!</h2>
                
                <div class="status-indicator status-waiting">
                    <h3>⏳ Aguardando professor iniciar o quiz...</h3>
                    <p>Você está conectado como <strong id="playerDisplayName"></strong></p>
                </div>

                <div class="live-ranking">
                    <h3>👥 Outros Participantes:</h3>
                    <div id="otherParticipants">
                        <div class="loading">Carregando...</div>
                    </div>
                </div>

                <button class="btn" onclick="leaveRoom()">← Sair da Sala</button>
            </div>
        </div>

        <!-- Jogo -->
        <div class="screen" id="gameScreen">
            <div class="content">
                <h2 id="gameTitle">Quiz em Andamento</h2>
                
                <div style="text-align: center; margin: 20px 0;">
                    <span>Pergunta <span id="currentQuestionNum">1</span> de <span id="totalQuestions">1</span></span>
                </div>

                <!-- Timer -->
                <div class="timer-container">
                    <div class="timer" id="gameTimer">
                        <div class="timer-text" id="timerText">20</div>
                    </div>
                    <p>⏰ Tempo restante</p>
                </div>

                <div class="question-item">
                    <h3 id="currentQuestion">Carregando pergunta...</h3>
                    <div id="questionImageContainer" style="display: none;">
                        <img id="questionImageGame" class="question-image-game" alt="Imagem da pergunta" onerror="this.parentElement.style.display='none'">
                    </div>
                </div>

                <!-- Status das respostas -->
                <div class="answers-status" id="answersStatus">
                    <p>Aguardando todos responderem...</p>
                    <div class="answers-progress">
                        <div class="answers-progress-bar" id="answersProgressBar" style="width: 0%"></div>
                    </div>
                    <small id="answersCount">0 de 0 responderam</small>
                </div>

                <div class="answers-grid" id="answersContainer">
                    <!-- Múltipla Escolha -->
                    <div class="answer-option answer-a" onclick="selectAnswer('A')" id="answerA">
                        A: Opção A
                    </div>
                    <div class="answer-option answer-b" onclick="selectAnswer('B')" id="answerB">
                        B: Opção B
                    </div>
                    <div class="answer-option answer-c" onclick="selectAnswer('C')" id="answerC">
                        C: Opção C
                    </div>
                    <div class="answer-option answer-d" onclick="selectAnswer('D')" id="answerD">
                        D: Opção D
                    </div>
                </div>

                <div class="live-ranking" id="liveRanking" style="display: none;">
                    <h3>🏆 Ranking Atual:</h3>
                    <div id="currentRanking"></div>
                </div>

                <div style="text-align: center; margin: 20px;">
                    <button class="btn" onclick="nextQuestion()" id="nextBtn" style="display: none;">
                        Próxima Pergunta →
                    </button>
                </div>
            </div>
        </div>

        <!-- Resultados -->
        <div class="screen" id="resultsScreen">
            <div class="content">
                <h2>🏆 Resultados Finais</h2>
                
                <div class="results" id="finalResults">
                    <div class="loading">Calculando resultados...</div>
                </div>

                <button class="btn btn-large" onclick="showScreen('homeScreen')">
                    🔄 Novo Quiz
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Importar Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getFirestore, collection, doc, setDoc, getDoc, updateDoc, onSnapshot, deleteDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

        // SUA CONFIGURAÇÃO DO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyDjMJdTA6U674e6Mx39A--CVkNcQKf8OxA",
            authDomain: "quizz-99.firebaseapp.com",
            projectId: "quizz-99",
            storageBucket: "quizz-99.firebasestorage.app",
            messagingSenderId: "507380078339",
            appId: "1:507380078339:web:8429d5965d5a265ee13b36"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Variáveis globais
        let currentQuiz = {
            title: '',
            questions: [],
            participants: {},
            currentQuestion: 0,
            timeLimit: 20, // Padrão agora é 20 segundos
            status: 'waiting',
            answeredBy: {} // Rastrear quem respondeu cada pergunta
        };

        let isTeacher = false;
        let playerName = '';
        let playerId = '';
        let selectedAvatar = '🧑‍🎓';
        let selectedTheme = 'default';
        let currentRoomCode = '';
        let gameTimer = null;
        let timeLeft = 20; // Padrão agora é 20 segundos
        let roomListener = null;
        let hasAnswered = false;
        let secretClickCount = 0;

        // =================== SISTEMA DE ÁUDIO ===================
        
        class QuizAudio {
            constructor() {
                this.audioContext = null;
                this.isMuted = localStorage.getItem('quizSoundMuted') === 'true';
                this.volume = 0.3;
                this.initAudio();
                this.updateSoundToggle();
            }

            async initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (error) {
                    console.log('Áudio não suportado:', error);
                }
            }

            async resumeAudio() {
                if (this.audioContext && this.audioContext.state === 'suspended') {
                    await this.audioContext.resume();
                }
            }

            createBeep(frequency, duration, type = 'sine') {
                if (!this.audioContext || this.isMuted) return;
                
                this.resumeAudio();
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(this.volume, this.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }

            // Sons específicos do quiz
            playSelect() {
                this.createBeep(800, 0.1, 'square');
            }

            playCorrect() {
                // Acorde alegre
                setTimeout(() => this.createBeep(523, 0.15), 0);    // C
                setTimeout(() => this.createBeep(659, 0.15), 100);  // E
                setTimeout(() => this.createBeep(784, 0.3), 200);   // G
            }

            playIncorrect() {
                // Som de erro
                this.createBeep(200, 0.5, 'sawtooth');
            }

            playTick() {
                this.createBeep(1000, 0.05);
            }

            playTimeWarning() {
                this.createBeep(1200, 0.1);
            }

            playGameStart() {
                // Fanfarra de início
                setTimeout(() => this.createBeep(523, 0.2), 0);
                setTimeout(() => this.createBeep(659, 0.2), 150);
                setTimeout(() => this.createBeep(784, 0.2), 300);
                setTimeout(() => this.createBeep(1047, 0.4), 450);
            }

            playGameEnd() {
                // Música de vitória
                setTimeout(() => this.createBeep(523, 0.2), 0);
                setTimeout(() => this.createBeep(659, 0.2), 200);
                setTimeout(() => this.createBeep(784, 0.2), 400);
                setTimeout(() => this.createBeep(523, 0.2), 600);
                setTimeout(() => this.createBeep(659, 0.2), 800);
                setTimeout(() => this.createBeep(784, 0.4), 1000);
            }

            playJoin() {
                // Som de entrada na sala
                setTimeout(() => this.createBeep(440, 0.2), 0);
                setTimeout(() => this.createBeep(554, 0.3), 150);
            }

            playNewQuestion() {
                // Som de nova pergunta
                this.createBeep(660, 0.2, 'triangle');
            }

            toggle() {
                this.isMuted = !this.isMuted;
                localStorage.setItem('quizSoundMuted', this.isMuted);
                this.updateSoundToggle();
                
                // Tocar som de teste se estiver desmutando
                if (!this.isMuted) {
                    setTimeout(() => this.playSelect(), 100);
                }
            }

            updateSoundToggle() {
                const toggle = document.getElementById('soundToggle');
                if (toggle) {
                    toggle.textContent = this.isMuted ? '🔇' : '🔊';
                    toggle.className = `sound-toggle ${this.isMuted ? 'muted' : ''}`;
                    toggle.title = this.isMuted ? 'Sons desativados - Clique para ativar' : 'Sons ativados - Clique para desativar';
                }
            }
        }

        // Instanciar sistema de áudio
        let gameAudio = new QuizAudio();

        // =================== SISTEMA DE QR CODE ===================
        
        function generateQRCode(roomCode) {
            if (!roomCode) return;
            
            // URL que será codificada no QR
            const currentUrl = window.location.origin + window.location.pathname;
            const qrUrl = `${currentUrl}?sala=${roomCode}`;
            
            // Usar API gratuita para gerar QR Code
            const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=170x170&format=png&data=${encodeURIComponent(qrUrl)}`;
            
            const qrImage = document.getElementById('qrCodeImage');
            const qrLoading = document.getElementById('qrLoading');
            
            if (qrImage && qrLoading) {
                // Mostrar loading primeiro
                qrLoading.style.display = 'flex';
                qrImage.style.display = 'none';
                
                // Criar nova imagem para verificar se carregou
                const img = new Image();
                img.onload = function() {
                    // QR Code carregou com sucesso
                    qrImage.src = qrApiUrl;
                    qrImage.style.display = 'block';
                    qrLoading.style.display = 'none';
                    
                    // 🎵 Som de sucesso
                    gameAudio.playSelect();
                    
                    console.log('QR Code gerado com sucesso:', qrUrl);
                };
                img.onerror = function() {
                    // Erro ao carregar QR Code
                    qrLoading.innerHTML = '<div style="color: #e74c3c; font-size: 0.9em;">❌ Erro ao gerar QR<br><small>Use o código manual</small></div>';
                    console.error('Erro ao gerar QR Code');
                };
                img.src = qrApiUrl;
            }
        }

        function checkForQRCodeEntry() {
            // Verificar se a página foi acessada via QR Code
            const urlParams = new URLSearchParams(window.location.search);
            const salaCode = urlParams.get('sala');
            
            if (salaCode) {
                console.log('Entrada via QR Code detectada:', salaCode);
                
                // 🎵 Som de entrada via QR Code
                setTimeout(() => {
                    gameAudio.playJoin();
                }, 500);
                
                // Preencher automaticamente o código da sala
                const roomCodeInput = document.getElementById('roomCodeInput');
                if (roomCodeInput) {
                    roomCodeInput.value = salaCode.toUpperCase();
                    
                    // Mostrar tela de participação se não estiver nela
                    if (!document.getElementById('joinScreen').classList.contains('active')) {
                        showScreen('joinScreen');
                    }
                    
                    // Focar no campo nome para facilitar
                    setTimeout(() => {
                        const nameInput = document.getElementById('playerName');
                        if (nameInput) {
                            nameInput.focus();
                        }
                    }, 500);
                    
                    // Feedback visual de que o código foi preenchido via QR
                    setTimeout(() => {
                        if (roomCodeInput) {
                            roomCodeInput.style.background = 'rgba(40, 167, 69, 0.1)';
                            roomCodeInput.style.borderColor = '#28a745';
                            
                            // Mostrar tooltip temporário
                            const tooltip = document.createElement('div');
                            tooltip.textContent = '✅ Código preenchido via QR Code!';
                            tooltip.style.cssText = `
                                position: absolute;
                                top: -40px;
                                left: 50%;
                                transform: translateX(-50%);
                                background: #28a745;
                                color: white;
                                padding: 8px 15px;
                                border-radius: 20px;
                                font-size: 0.9em;
                                font-weight: 600;
                                z-index: 1000;
                                animation: tooltipFade 3s ease forwards;
                            `;
                            
                            roomCodeInput.parentElement.style.position = 'relative';
                            roomCodeInput.parentElement.appendChild(tooltip);
                            
                            // Remover tooltip após 3 segundos
                            setTimeout(() => {
                                if (tooltip.parentElement) {
                                    tooltip.remove();
                                }
                            }, 3000);
                        }
                    }, 300);
                }
                
                // Limpar URL para não ficar mostrando parâmetros
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        // Tornar funções globais
        window.showScreen = showScreen;
        window.addQuestion = addQuestion;
        window.deleteQuestion = deleteQuestion;
        window.createRoom = createRoom;
        window.showPersonalization = showPersonalization;
        window.joinRoom = joinRoom;
        window.startGame = startGame;
        window.selectAnswer = selectAnswer;
        window.nextQuestion = nextQuestion;
        window.leaveRoom = leaveRoom;
        window.toggleQuestionType = toggleQuestionType;

        // =================== FUNÇÕES DE TELA ===================

        function showScreen(screenId) {
            console.log('Mudando para tela:', screenId);
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // =================== STATUS DE CONEXÃO ===================

        function updateConnectionStatus(status, message = '') {
            const statusEl = document.getElementById('connectionStatus');
            statusEl.className = `connection-status ${status}`;
            statusEl.title = message;
            
            switch(status) {
                case 'connected':
                    statusEl.textContent = '🌐';
                    break;
                case 'connecting':
                    statusEl.textContent = '⏳';
                    break;
                case 'error':
                    statusEl.textContent = '❌';
                    break;
            }
        }

        // =================== ACESSO SECRETO DO PROFESSOR ===================

        function secretClick() {
            secretClickCount++;
            
            // Feedback visual discreto na área secreta
            const secretArea = document.getElementById('secretArea');
            if (secretArea) {
                secretArea.classList.add('clicking');
                setTimeout(() => {
                    secretArea.classList.remove('clicking');
                }, 200);
            }
            
            // Som discreto a cada clique
            gameAudio.playTick();
            
            if (secretClickCount === 5) {
                // Resetar contador
                secretClickCount = 0;
                // Acesso liberado!
                showScreen('createScreen');
                // Feedback de sucesso
                updateConnectionStatus('connected', 'Modo Professor Ativado');
                gameAudio.playCorrect();
                
                // Feedback visual de sucesso
                if (secretArea) {
                    secretArea.style.background = 'rgba(40, 167, 69, 0.2)';
                    setTimeout(() => {
                        secretArea.style.background = 'transparent';
                    }, 1000);
                }
            }
            
            // Resetar contador após 4 segundos se não completar
            setTimeout(() => {
                if (secretClickCount > 0 && secretClickCount < 5) {
                    secretClickCount = 0;
                    console.log('Contador resetado - tempo esgotado');
                }
            }, 4000);
        }

        // =================== FUNÇÕES DO FIREBASE ===================

        function generateRoomCode() {
            return Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        async function createRoom() {
            const title = document.getElementById('quizTitle').value;
            const timeLimit = parseInt(document.getElementById('timeLimit').value);
            
            if (!title) {
                alert('Por favor, digite um nome para o quiz!');
                return;
            }
            
            if (currentQuiz.questions.length === 0) {
                alert('Adicione pelo menos uma pergunta!');
                return;
            }

            try {
                updateConnectionStatus('connecting', 'Criando sala...');
                
                const roomCode = generateRoomCode();
                currentRoomCode = roomCode;
                isTeacher = true;

                const roomData = {
                    title: title,
                    questions: currentQuiz.questions,
                    timeLimit: timeLimit,
                    participants: {},
                    currentQuestion: 0,
                    status: 'waiting',
                    answeredBy: {},
                    createdAt: new Date(),
                    teacher: true
                };

                await setDoc(doc(db, 'rooms', roomCode), roomData);
                
                document.getElementById('roomCode').textContent = roomCode;
                
                // 🎯 Gerar QR Code automaticamente
                generateQRCode(roomCode);
                
                listenToRoom(roomCode);
                showScreen('waitingScreen');
                updateConnectionStatus('connected', 'Sala criada!');
                
            } catch (error) {
                console.error('Erro ao criar sala:', error);
                alert('Erro ao criar sala: ' + error.message);
                updateConnectionStatus('error', 'Erro ao conectar');
            }
        }

        async function joinRoom() {
            try {
                updateConnectionStatus('connecting', 'Entrando na sala...');
                
                const roomCode = document.getElementById('roomCodeInput').value.toUpperCase();
                const name = document.getElementById('playerName').value;
                
                if (!roomCode || !name) {
                    alert('Por favor, preencha todos os campos!');
                    return;
                }

                const roomRef = doc(db, 'rooms', roomCode);
                const roomSnap = await getDoc(roomRef);
                
                if (!roomSnap.exists()) {
                    alert('Sala não encontrada! Verifique o código.');
                    updateConnectionStatus('error', 'Sala não encontrada');
                    return;
                }

                const roomData = roomSnap.data();
                
                if (roomData.status === 'finished') {
                    alert('Este quiz já terminou!');
                    return;
                }

                currentRoomCode = roomCode;
                playerName = name;
                playerId = Date.now().toString();
                isTeacher = false;

                const playerData = {
                    name: name,
                    avatar: selectedAvatar,
                    score: 0,
                    answers: [],
                    joinedAt: new Date()
                };

                await updateDoc(roomRef, {
                    [`participants.${playerId}`]: playerData
                });

                listenToRoom(roomCode);
                applyTheme(selectedTheme);
                
                // 🎵 Som de entrada na sala
                gameAudio.playJoin();
                
                document.getElementById('playerDisplayName').textContent = `${selectedAvatar} ${name}`;
                showScreen('playerWaitingScreen');
                updateConnectionStatus('connected', 'Conectado!');
                
            } catch (error) {
                console.error('Erro ao entrar na sala:', error);
                alert('Erro ao entrar na sala: ' + error.message);
                updateConnectionStatus('error', 'Erro ao conectar');
            }
        }

        function listenToRoom(roomCode) {
            if (roomListener) {
                roomListener();
            }

            const roomRef = doc(db, 'rooms', roomCode);
            roomListener = onSnapshot(roomRef, (doc) => {
                if (doc.exists()) {
                    const roomData = doc.data();
                    updateRoomDisplay(roomData);
                } else {
                    alert('Sala foi removida!');
                    leaveRoom();
                }
            });
        }

        function updateRoomDisplay(roomData) {
            const participants = roomData.participants || {};
            const previousQuestion = currentQuiz.currentQuestion;
            currentQuiz = roomData;
            
            // Debug log
            if (!isTeacher && previousQuestion !== roomData.currentQuestion) {
                console.log(`Aluno: Pergunta mudou de ${previousQuestion} para ${roomData.currentQuestion}`);
            }
            
            if (isTeacher) {
                updateParticipantsList(participants);
                
                // Professor: TAMBÉM atualizar progresso das respostas
                if (roomData.status === 'playing') {
                    updateAnswersProgress(roomData.answeredBy || {}, participants);
                    
                    const studentParticipants = Object.values(participants).filter(p => p.name !== 'Professor');
                    const totalStudents = studentParticipants.length;
                    const currentAnswers = (roomData.answeredBy || {})[roomData.currentQuestion] || {};
                    const answeredCount = Object.keys(currentAnswers).length;
                    
                    if (answeredCount === totalStudents && totalStudents > 0 && gameTimer) {
                        console.log('Professor: Todos os alunos responderam! Parando timer');
                        stopTimer();
                        setTimeout(() => {
                            document.getElementById('nextBtn').style.display = 'block';
                        }, 2000); // Dar tempo para ver os resultados
                    }
                }
            } else {
                updateOtherParticipants(participants);
            }

            // Verificar mudança de status
            if (roomData.status === 'playing' && !isTeacher) {
                // Se não estiver na tela do jogo, ir para ela
                if (!document.getElementById('gameScreen').classList.contains('active')) {
                    console.log('Aluno: Entrando na tela do jogo');
                    showScreen('gameScreen');
                    loadCurrentQuestion();
                }
                // Se a pergunta mudou, carregar nova pergunta
                else if (previousQuestion !== roomData.currentQuestion) {
                    console.log('Aluno: Carregando nova pergunta');
                    hasAnswered = false; // Resetar estado de resposta
                    loadCurrentQuestion();
                }
                // Se estiver na mesma pergunta, atualizar progresso
                else {
                    updateAnswersProgress(roomData.answeredBy || {}, participants);
                    
                    // Verificar se todos os ALUNOS responderam
                    const studentParticipants = Object.values(participants).filter(p => p.name !== 'Professor');
                    const totalStudents = studentParticipants.length;
                    const currentAnswers = (roomData.answeredBy || {})[roomData.currentQuestion] || {};
                    const answeredCount = Object.keys(currentAnswers).length;
                    
                    // Verificar se ainda não mostrou os resultados
                    const allAnswered = answeredCount === totalStudents && totalStudents > 0;
                    const resultsShown = document.querySelectorAll('.answer-option.correct, .answer-option.incorrect').length > 0;
                    
                    if (allAnswered && !resultsShown) {
                        // Todos os alunos responderam - parar timer e mostrar resultados IMEDIATAMENTE
                        console.log('Aluno: Todos os alunos responderam! Parando timer e mostrando resultados');
                        stopTimer();
                        showQuestionResults(roomData);
                    }
                }
            } else if (roomData.status === 'finished') {
                showResults(participants);
            }

            // Atualizar ranking em tempo real durante o jogo
            if (roomData.status === 'playing') {
                updateLiveRanking(participants);
            }
        }

        // =================== FUNÇÕES DE PROGRESSO ===================

        function updateAnswersProgress(answeredBy, participants) {
            try {
                // Contar apenas ALUNOS (excluir professor)
                const studentParticipants = Object.values(participants).filter(p => p.name !== 'Professor');
                const totalStudents = studentParticipants.length;
                const currentAnswers = answeredBy[currentQuiz.currentQuestion] || {};
                const answeredCount = Object.keys(currentAnswers).length;
                
                const percentage = totalStudents > 0 ? (answeredCount / totalStudents) * 100 : 0;
                
                const progressBar = document.getElementById('answersProgressBar');
                const answersCount = document.getElementById('answersCount');
                const answersStatus = document.getElementById('answersStatus');
                
                if (progressBar) {
                    progressBar.style.width = percentage + '%';
                }
                
                if (answersCount) {
                    answersCount.textContent = `${answeredCount} de ${totalStudents} responderam`;
                }
                
                // Atualizar mensagem de status
                if (answersStatus) {
                    if (answeredCount === totalStudents && totalStudents > 0) {
                        answersStatus.innerHTML = '<p style="color: #28a745; font-weight: bold; font-size: 1.1em;">✅ Todos responderam!</p>';
                        answersStatus.classList.add('all-answered');
                    } else {
                        answersStatus.innerHTML = '<p>Aguardando todos responderem...</p>';
                        answersStatus.classList.remove('all-answered');
                    }
                }
                
                // Log para debug
                console.log(`Progresso: ${answeredCount}/${totalStudents} alunos responderam (${percentage.toFixed(1)}%)`);
                
                // Se todos os ALUNOS responderam, avisar
                if (answeredCount === totalStudents && totalStudents > 0) {
                    console.log('🎯 TODOS OS ALUNOS RESPONDERAM! Deveria parar timer agora');
                }
            } catch (error) {
                console.error('Erro em updateAnswersProgress:', error);
            }
        }

        async function showQuestionResults(roomData) {
            // Parar timer imediatamente se ainda estiver rodando
            stopTimer();
            
            const question = roomData.questions[roomData.currentQuestion];
            const currentAnswers = (roomData.answeredBy || {})[roomData.currentQuestion] || {};
            
            console.log('Mostrando resultados da pergunta:', question.question);
            
            // Mostrar feedback visual para todos
            document.querySelectorAll('.answer-option').forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            // Destacar resposta correta baseado no tipo da pergunta
            const questionType = question.type || 'multiple'; // Compatibilidade
            
            if (questionType === 'truefalse') {
                const correctElement = question.correct === 'true' ? 
                    document.getElementById('answerTrue') : 
                    document.getElementById('answerFalse');
                if (correctElement) {
                    correctElement.classList.add('correct');
                }
            } else {
                // Múltipla escolha (compatibilidade)
                const correctElement = document.getElementById(`answer${question.correct}`);
                if (correctElement) {
                    correctElement.classList.add('correct');
                }
            }
            
            // Se o jogador respondeu, destacar sua resposta
            if (currentAnswers[playerId]) {
                const playerAnswer = currentAnswers[playerId].answer;
                const isCorrect = playerAnswer === question.correct;
                
                if (!isCorrect) {
                    // Destacar resposta incorreta do jogador
                    if (questionType === 'truefalse') {
                        const wrongElement = playerAnswer === 'true' ? 
                            document.getElementById('answerTrue') : 
                            document.getElementById('answerFalse');
                        if (wrongElement) {
                            wrongElement.classList.add('incorrect');
                        }
                    } else {
                        const wrongElement = document.getElementById(`answer${playerAnswer}`);
                        if (wrongElement) {
                            wrongElement.classList.add('incorrect');
                        }
                    }
                }
                
                // Mostrar feedback com som
                if (isCorrect) {
                    // 🎵 Som de acerto + confete
                    gameAudio.playCorrect();
                    createConfetti();
                    setTimeout(() => alert('🎉 Você acertou!'), 500);
                } else {
                    // 🎵 Som de erro
                    gameAudio.playIncorrect();
                    const correctText = questionType === 'truefalse' 
                        ? (question.correct === 'true' ? 'Verdadeiro' : 'Falso')
                        : question.correct;
                    setTimeout(() => alert(`❌ Você errou! A resposta correta era: ${correctText}`), 500);
                }
            }
            
            // Mostrar botão próxima pergunta para professor após um tempo
            if (isTeacher) {
                setTimeout(() => {
                    document.getElementById('nextBtn').style.display = 'block';
                }, 2000);
            }
        }

        // =================== FUNÇÕES DO JOGO ===================

        function toggleQuestionType() {
            const questionType = document.getElementById('questionType').value;
            const multipleChoiceOptions = document.getElementById('multipleChoiceOptions');
            const multipleChoiceCorrect = document.getElementById('multipleChoiceCorrect');
            const trueFalseCorrect = document.getElementById('trueFalseCorrect');
            
            if (questionType === 'truefalse') {
                multipleChoiceOptions.style.display = 'none';
                multipleChoiceCorrect.style.display = 'none';
                trueFalseCorrect.style.display = 'block';
            } else {
                multipleChoiceOptions.style.display = 'block';
                multipleChoiceCorrect.style.display = 'block';
                trueFalseCorrect.style.display = 'none';
            }
        }

        function addQuestion() {
            const questionType = document.getElementById('questionType').value;
            const question = document.getElementById('questionText').value;
            const questionImage = document.getElementById('questionImage').value;
            
            if (!question) {
                alert('Por favor, digite uma pergunta!');
                return;
            }

            let newQuestion;

            if (questionType === 'truefalse') {
                // Pergunta Verdadeiro/Falso
                const correctTrue = document.getElementById('correctTrue').checked;
                const correctFalse = document.getElementById('correctFalse').checked;
                
                if (!correctTrue && !correctFalse) {
                    alert('Por favor, selecione a resposta correta (Verdadeiro ou Falso)!');
                    return;
                }

                newQuestion = {
                    type: 'truefalse',
                    question: question,
                    image: questionImage || null,
                    options: {
                        true: 'Verdadeiro',
                        false: 'Falso'
                    },
                    correct: correctTrue ? 'true' : 'false'
                };
            } else {
                // Pergunta Múltipla Escolha
                const optionA = document.getElementById('optionA').value;
                const optionB = document.getElementById('optionB').value;
                const optionC = document.getElementById('optionC').value;
                const optionD = document.getElementById('optionD').value;
                const correct = document.getElementById('correctAnswer').value;
                
                if (!optionA || !optionB || !optionC || !optionD) {
                    alert('Por favor, preencha todas as opções!');
                    return;
                }

                newQuestion = {
                    type: 'multiple',
                    question: question,
                    image: questionImage || null,
                    options: {
                        A: optionA,
                        B: optionB,
                        C: optionC,
                        D: optionD
                    },
                    correct: correct
                };
            }

            currentQuiz.questions.push(newQuestion);
            
            // 🎵 Som de sucesso ao adicionar pergunta
            gameAudio.playCorrect();
            
            updateQuestionsList();
            clearQuestionForm();
        }

        function updateQuestionsList() {
            const list = document.getElementById('questionsList');
            list.innerHTML = '';
            
            currentQuiz.questions.forEach((q, index) => {
                const div = document.createElement('div');
                div.className = 'question-item';
                div.style.animation = 'questionEntry 0.6s ease';
                
                const questionTypeIcon = (q.type || 'multiple') === 'truefalse' ? '✅❌' : '🔤';
                const questionTypeText = (q.type || 'multiple') === 'truefalse' ? 'Verdadeiro ou Falso' : 'Múltipla Escolha';
                const imageIcon = q.image ? ' 🖼️' : '';
                
                // Verificar se tem imagem
                const imageHtml = q.image ? `
                    <img src="${q.image}" class="question-image" alt="Imagem da pergunta" onerror="this.style.display='none'">
                ` : '';
                
                let optionsHtml = '';
                
                if ((q.type || 'multiple') === 'truefalse') {
                    optionsHtml = `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                            <div style="padding: 12px 20px; background: rgba(40,167,69,0.2); border-radius: 12px; text-align: center; font-weight: 600;">
                                ✅ Verdadeiro
                            </div>
                            <div style="padding: 12px 20px; background: rgba(220,53,69,0.2); border-radius: 12px; text-align: center; font-weight: 600;">
                                ❌ Falso
                            </div>
                        </div>
                    `;
                } else {
                    optionsHtml = `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
                            <div style="padding: 8px 12px; background: rgba(255,107,107,0.2); border-radius: 8px; font-size: 0.9em;">
                                <strong>A:</strong> ${q.options.A}
                            </div>
                            <div style="padding: 8px 12px; background: rgba(78,205,196,0.2); border-radius: 8px; font-size: 0.9em;">
                                <strong>B:</strong> ${q.options.B}
                            </div>
                            <div style="padding: 8px 12px; background: rgba(69,183,209,0.2); border-radius: 8px; font-size: 0.9em;">
                                <strong>C:</strong> ${q.options.C}
                            </div>
                            <div style="padding: 8px 12px; background: rgba(150,206,180,0.2); border-radius: 8px; font-size: 0.9em;">
                                <strong>D:</strong> ${q.options.D}
                            </div>
                        </div>
                    `;
                }
                
                const correctAnswerText = (q.type || 'multiple') === 'truefalse' 
                    ? (q.correct === 'true' ? 'Verdadeiro' : 'Falso')
                    : q.correct;
                
                div.innerHTML = `
                    <button class="delete-btn" onclick="deleteQuestion(${index})" title="Excluir pergunta">🗑️</button>
                    <h4 style="color: #333 !important; margin-bottom: 10px; margin-right: 50px;">
                        ${questionTypeIcon} Pergunta ${index + 1}${imageIcon} <small style="color: #666;">(${questionTypeText})</small>
                    </h4>
                    <p style="color: #333 !important; font-weight: 600; margin-bottom: 15px; font-size: 1.1em;">
                        ${q.question}
                    </p>
                    ${imageHtml}
                    ${optionsHtml}
                    <p style="color: #667eea !important; font-weight: 700; text-align: center; margin-top: 10px;">
                        ✅ Resposta correta: <span style="background: rgba(102,126,234,0.2); padding: 2px 8px; border-radius: 12px;">${correctAnswerText}</span>
                    </p>
                `;
                list.appendChild(div);
            });

            if (currentQuiz.questions.length > 0) {
                document.getElementById('createBtn').style.display = 'block';
            } else {
                document.getElementById('createBtn').style.display = 'none';
            }
        }

        function deleteQuestion(index) {
            if (confirm(`🗑️ Tem certeza que deseja excluir a Pergunta ${index + 1}?`)) {
                currentQuiz.questions.splice(index, 1);
                
                // 🎵 Som de confirmação
                gameAudio.playSelect();
                
                updateQuestionsList();
                
                // Feedback visual
                const list = document.getElementById('questionsList');
                if (list) {
                    list.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        list.style.transform = 'scale(1)';
                    }, 200);
                }
            }
        }

        function clearQuestionForm() {
            document.getElementById('questionText').value = '';
            document.getElementById('questionImage').value = '';
            document.getElementById('optionA').value = '';
            document.getElementById('optionB').value = '';
            document.getElementById('optionC').value = '';
            document.getElementById('optionD').value = '';
            document.getElementById('correctTrue').checked = false;
            document.getElementById('correctFalse').checked = false;
            document.getElementById('questionType').value = 'multiple';
            toggleQuestionType(); // Resetar para múltipla escolha
        }

        async function startGame() {
            if (!isTeacher) return;
            
            try {
                console.log('Professor iniciando jogo...');
                
                // 🎵 Som de início do jogo
                gameAudio.playGameStart();
                
                const roomRef = doc(db, 'rooms', currentRoomCode);
                await updateDoc(roomRef, {
                    status: 'playing',
                    currentQuestion: 0,
                    answeredBy: {},
                    startedAt: new Date()
                });
                
                console.log('Status do jogo atualizado no Firebase');
                
                // Ir para tela do jogo
                showScreen('gameScreen');
                
                // Aguardar um pouco antes de carregar a pergunta para garantir que a tela mudou
                setTimeout(() => {
                    try {
                        loadCurrentQuestion();
                        console.log('Primeira pergunta carregada com sucesso');
                    } catch (error) {
                        console.error('Erro ao carregar primeira pergunta:', error);
                        alert('Erro ao carregar pergunta: ' + error.message);
                    }
                }, 100);
                
            } catch (error) {
                console.error('Erro ao iniciar jogo:', error);
                alert('Erro ao iniciar jogo: ' + error.message);
            }
        }

        function loadCurrentQuestion() {
            console.log('Iniciando loadCurrentQuestion...');
            
            if (!currentQuiz.questions || currentQuiz.questions.length === 0) {
                console.error('Nenhuma pergunta disponível!');
                alert('Erro: Nenhuma pergunta encontrada!');
                return;
            }
            
            if (currentQuiz.currentQuestion >= currentQuiz.questions.length) {
                console.error('Índice de pergunta inválido!');
                return;
            }
            
            const question = currentQuiz.questions[currentQuiz.currentQuestion];
            console.log('Pergunta encontrada:', question);
            
            hasAnswered = false;
            
            // Parar timer anterior se existir
            try {
                stopTimer();
                console.log('Timer parado com sucesso');
            } catch (error) {
                console.error('Erro ao parar timer:', error);
            }
            
            // Verificar se todos os elementos existem antes de acessá-los
            const gameTitle = document.getElementById('gameTitle');
            const currentQuestionNum = document.getElementById('currentQuestionNum');
            const totalQuestions = document.getElementById('totalQuestions');
            const currentQuestionEl = document.getElementById('currentQuestion');
            const answersContainer = document.getElementById('answersContainer');
            const nextBtn = document.getElementById('nextBtn');
            const liveRanking = document.getElementById('liveRanking');
            const answersProgressBar = document.getElementById('answersProgressBar');
            const answersCount = document.getElementById('answersCount');
            const answersStatus = document.getElementById('answersStatus');
            
            if (gameTitle) gameTitle.textContent = currentQuiz.title;
            if (currentQuestionNum) currentQuestionNum.textContent = currentQuiz.currentQuestion + 1;
            if (totalQuestions) totalQuestions.textContent = currentQuiz.questions.length;
            if (currentQuestionEl) currentQuestionEl.textContent = question.question;
            
            // Mostrar imagem se existir
            const questionImageContainer = document.getElementById('questionImageContainer');
            const questionImageGame = document.getElementById('questionImageGame');
            
            if (question.image && questionImageContainer && questionImageGame) {
                questionImageGame.src = question.image;
                questionImageGame.onload = function() {
                    questionImageContainer.style.display = 'block';
                    this.style.animation = 'imageSlideIn 0.6s ease';
                };
                questionImageGame.onerror = function() {
                    questionImageContainer.style.display = 'none';
                    console.log('Erro ao carregar imagem:', question.image);
                };
            } else if (questionImageContainer) {
                questionImageContainer.style.display = 'none';
            }
            
            // Configurar layout baseado no tipo de pergunta
            if (answersContainer) {
                // Compatibilidade: se não tem tipo definido, assume múltipla escolha
                const questionType = question.type || 'multiple';
                
                if (questionType === 'truefalse') {
                    // Layout para Verdadeiro/Falso
                    answersContainer.className = 'answers-grid true-false';
                    answersContainer.innerHTML = `
                        <div class="answer-option answer-a true-false" onclick="selectAnswer('true')" id="answerTrue">
                            <div class="tf-icon">✅</div>
                            <div class="tf-text">Verdadeiro</div>
                        </div>
                        <div class="answer-option answer-b true-false" onclick="selectAnswer('false')" id="answerFalse">
                            <div class="tf-icon">❌</div>
                            <div class="tf-text">Falso</div>
                        </div>
                    `;
                } else {
                    // Layout para Múltipla Escolha (compatibilidade com perguntas antigas)
                    answersContainer.className = 'answers-grid';
                    answersContainer.innerHTML = `
                        <div class="answer-option answer-a" onclick="selectAnswer('A')" id="answerA">
                            A: ${question.options.A}
                        </div>
                        <div class="answer-option answer-b" onclick="selectAnswer('B')" id="answerB">
                            B: ${question.options.B}
                        </div>
                        <div class="answer-option answer-c" onclick="selectAnswer('C')" id="answerC">
                            C: ${question.options.C}
                        </div>
                        <div class="answer-option answer-d" onclick="selectAnswer('D')" id="answerD">
                            D: ${question.options.D}
                        </div>
                    `;
                }
            }
            
            // Resetar todas as opções de resposta
            try {
                document.querySelectorAll('.answer-option').forEach(option => {
                    if (option) {
                        option.style.opacity = '1';
                        option.style.pointerEvents = 'auto';
                        option.classList.remove('correct', 'incorrect', 'selected');
                        option.style.border = '3px solid rgba(255,255,255,0.3)';
                        option.style.transform = 'scale(1)';
                        option.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.2)';
                    }
                });
                console.log('Opções resetadas com sucesso');
            } catch (error) {
                console.error('Erro ao resetar opções:', error);
            }
            
            if (nextBtn) nextBtn.style.display = 'none';
            if (liveRanking) liveRanking.style.display = 'block';
            
            // Resetar progresso das respostas
            if (answersProgressBar) answersProgressBar.style.width = '0%';
            if (answersCount) answersCount.textContent = '0 de 0 responderam';
            
            // Resetar mensagem de status
            if (answersStatus) {
                answersStatus.innerHTML = '<p>Aguardando todos responderem...</p>';
                answersStatus.classList.remove('all-answered');
            }
            
            // Iniciar timer
            try {
                startTimer();
                console.log('Timer iniciado com sucesso');
                
                // 🎵 Som de nova pergunta (só para alunos, professor já ouviu quando clicou)
                if (!isTeacher) {
                    setTimeout(() => gameAudio.playNewQuestion(), 200);
                }
                
            } catch (error) {
                console.error('Erro ao iniciar timer:', error);
            }
            
            console.log(`Pergunta ${currentQuiz.currentQuestion + 1} carregada:`, question.question);
        }

        async function selectAnswer(answer) {
            if (!currentRoomCode || isTeacher || hasAnswered) return;
            
            hasAnswered = true;
            
            // 🎵 Som de seleção
            gameAudio.playSelect();
            
            // Destacar visualmente a opção selecionada
            document.querySelectorAll('.answer-option').forEach(option => {
                option.classList.remove('selected');
                option.style.pointerEvents = 'none';
            });
            
            // Para verdadeiro/falso, encontrar o elemento correto
            const question = currentQuiz.questions[currentQuiz.currentQuestion];
            if ((question.type || 'multiple') === 'truefalse') {
                const selectedElement = answer === 'true' ? 
                    document.getElementById('answerTrue') : 
                    document.getElementById('answerFalse');
                if (selectedElement) {
                    selectedElement.classList.add('selected');
                }
            } else {
                // Múltipla escolha
                document.getElementById(`answer${answer}`).classList.add('selected');
            }
            
            try {
                const roomRef = doc(db, 'rooms', currentRoomCode);
                const timeBonus = Math.floor((timeLeft / currentQuiz.timeLimit) * 50);
                
                await updateDoc(roomRef, {
                    [`answeredBy.${currentQuiz.currentQuestion}.${playerId}`]: {
                        answer: answer,
                        timeBonus: timeBonus,
                        timestamp: new Date()
                    }
                });
                
            } catch (error) {
                console.error('Erro ao registrar resposta:', error);
            }
        }

        async function updatePlayerScore(points) {
            try {
                const roomRef = doc(db, 'rooms', currentRoomCode);
                await updateDoc(roomRef, {
                    [`participants.${playerId}.score`]: (currentQuiz.participants[playerId]?.score || 0) + points
                });
            } catch (error) {
                console.error('Erro ao atualizar pontuação:', error);
            }
        }

        async function nextQuestion() {
            if (!isTeacher) return;
            
            try {
                // Calcular pontuações da pergunta atual
                await calculateQuestionScores();
                
                const newQuestionIndex = currentQuiz.currentQuestion + 1;
                
                if (newQuestionIndex < currentQuiz.questions.length) {
                    console.log(`Professor avançando para pergunta ${newQuestionIndex + 1}`);
                    
                    const roomRef = doc(db, 'rooms', currentRoomCode);
                    await updateDoc(roomRef, {
                        currentQuestion: newQuestionIndex
                    });
                    
                    // Atualizar localmente e recarregar pergunta
                    currentQuiz.currentQuestion = newQuestionIndex;
                    loadCurrentQuestion();
                    
                } else {
                    // Finalizar quiz
                    console.log('Professor finalizando quiz');
                    await updateDoc(doc(db, 'rooms', currentRoomCode), {
                        status: 'finished',
                        finishedAt: new Date()
                    });
                }
            } catch (error) {
                console.error('Erro ao avançar pergunta:', error);
                alert('Erro ao avançar pergunta: ' + error.message);
            }
        }

        async function calculateQuestionScores() {
            const question = currentQuiz.questions[currentQuiz.currentQuestion];
            const currentAnswers = (currentQuiz.answeredBy || {})[currentQuiz.currentQuestion] || {};
            
            const roomRef = doc(db, 'rooms', currentRoomCode);
            
            for (const [pId, answerData] of Object.entries(currentAnswers)) {
                const isCorrect = answerData.answer === question.correct;
                if (isCorrect) {
                    const points = 100 + answerData.timeBonus;
                    const currentScore = currentQuiz.participants[pId]?.score || 0;
                    
                    await updateDoc(roomRef, {
                        [`participants.${pId}.score`]: currentScore + points
                    });
                }
            }
        }

        // =================== OUTRAS FUNÇÕES ===================

        function updateParticipantsList(participants) {
            const list = document.getElementById('participantsList');
            if (!list) return;

            list.innerHTML = '';
            
            const participantList = Object.values(participants);
            
            if (participantList.length === 0) {
                list.innerHTML = '<div class="loading">Aguardando participantes</div>';
                return;
            }

            participantList.forEach(participant => {
                const div = document.createElement('div');
                div.className = 'participant-item';
                div.innerHTML = `
                    <span>
                        <span class="participant-avatar">${participant.avatar}</span>
                        ${participant.name}
                    </span>
                    <span style="color: green;">✅ Online</span>
                `;
                list.appendChild(div);
            });
        }

        function updateOtherParticipants(participants) {
            const list = document.getElementById('otherParticipants');
            if (!list) return;

            list.innerHTML = '';
            
            // Filtrar apenas alunos (não professor) e remover o jogador atual
            const otherStudents = Object.values(participants)
                .filter(p => p.name !== 'Professor' && p.name !== playerName);
            
            if (otherStudents.length === 0) {
                list.innerHTML = '<div>Você é o único participante!</div>';
                return;
            }

            otherStudents.forEach(participant => {
                const div = document.createElement('div');
                div.className = 'ranking-item';
                div.innerHTML = `
                    <span>${participant.avatar} ${participant.name}</span>
                    <span>🟢 Online</span>
                `;
                list.appendChild(div);
            });
        }

        function updateLiveRanking(participants) {
            const rankingDiv = document.getElementById('currentRanking');
            if (!rankingDiv) return;

            const sortedParticipants = Object.values(participants)
                .sort((a, b) => (b.score || 0) - (a.score || 0))
                .slice(0, 5);

            rankingDiv.innerHTML = '';
            
            sortedParticipants.forEach((participant, index) => {
                const div = document.createElement('div');
                div.className = 'ranking-item';
                
                let medal = '';
                if (index === 0) medal = '🥇';
                else if (index === 1) medal = '🥈';
                else if (index === 2) medal = '🥉';
                else medal = `${index + 1}️⃣`;
                
                div.innerHTML = `
                    <span>${medal} ${participant.avatar} ${participant.name}</span>
                    <span><strong>${participant.score || 0} pts</strong></span>
                `;
                rankingDiv.appendChild(div);
            });
        }

        function showResults(participants) {
            // 🎵 Som de fim de jogo + confete
            gameAudio.playGameEnd();
            createConfetti();
            
            const resultsDiv = document.getElementById('finalResults');
            resultsDiv.innerHTML = '';
            
            // Filtrar apenas alunos (não professor) e ordenar por pontuação
            const studentParticipants = Object.values(participants)
                .filter(p => p.name !== 'Professor')
                .sort((a, b) => (b.score || 0) - (a.score || 0));
            
            studentParticipants.forEach((participant, index) => {
                const div = document.createElement('div');
                div.className = 'result-item';
                
                let medal = '';
                if (index === 0) medal = '🥇';
                else if (index === 1) medal = '🥈';
                else if (index === 2) medal = '🥉';
                
                div.innerHTML = `
                    <span>${medal} ${participant.avatar} ${participant.name}</span>
                    <span class="score">${participant.score || 0} pts</span>
                `;
                resultsDiv.appendChild(div);
            });
            
            showScreen('resultsScreen');
        }

        async function leaveRoom() {
            if (roomListener) {
                roomListener();
                roomListener = null;
            }
            
            currentRoomCode = '';
            isTeacher = false;
            playerName = '';
            playerId = '';
            hasAnswered = false;
            
            showScreen('homeScreen');
        }

        // =================== FUNÇÕES DE TIMER ===================

        function stopTimer() {
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            const timerElement = document.getElementById('gameTimer');
            if (timerElement) {
                timerElement.classList.remove('urgent');
            }
        }

        function startTimer() {
            // Garantir que não há timer anterior rodando
            stopTimer();
            
            timeLeft = currentQuiz.timeLimit;
            updateTimerDisplay();
            
            gameTimer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                // 🎵 Som de tick a cada segundo (só últimos 10 segundos)
                if (timeLeft <= 10 && timeLeft > 0) {
                    gameAudio.playTick();
                }
                
                if (timeLeft <= 5) {
                    const timerEl = document.getElementById('gameTimer');
                    if (timerEl) {
                        timerEl.classList.add('urgent');
                    }
                    
                    // 🎵 Som de aviso (mais intenso nos últimos 5 segundos)
                    if (timeLeft <= 5 && timeLeft > 0) {
                        gameAudio.playTimeWarning();
                    }
                }
                
                if (timeLeft <= 0) {
                    clearInterval(gameTimer);
                    gameTimer = null;
                    if (isTeacher) {
                        const nextBtn = document.getElementById('nextBtn');
                        if (nextBtn) {
                            nextBtn.style.display = 'block';
                        }
                    }
                }
                
                // Verificação extra: se todos os ALUNOS já responderam, parar timer
                if (currentRoomCode && currentQuiz.status === 'playing') {
                    const studentParticipants = Object.values(currentQuiz.participants || {}).filter(p => p.name !== 'Professor');
                    const totalStudents = studentParticipants.length;
                    const currentAnswers = (currentQuiz.answeredBy || {})[currentQuiz.currentQuestion] || {};
                    const answeredCount = Object.keys(currentAnswers).length;
                    
                    if (answeredCount === totalStudents && totalStudents > 0) {
                        console.log('Timer: Todos os alunos já responderam, parando timer automaticamente');
                        clearInterval(gameTimer);
                        gameTimer = null;
                        return;
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerElement = document.getElementById('gameTimer');
            const textElement = document.getElementById('timerText');
            
            if (textElement) {
                textElement.textContent = timeLeft;
            }
            
            if (timerElement) {
                const percentage = (timeLeft / currentQuiz.timeLimit) * 360;
                timerElement.style.background = `conic-gradient(#ff6b6b ${percentage}deg, #ddd ${percentage}deg)`;
            }
        }

        // =================== PERSONALIZAÇÃO ===================

        function showPersonalization() {
            const name = document.getElementById('playerName').value;
            const roomCode = document.getElementById('roomCodeInput').value;
            
            if (!name || !roomCode) {
                alert('Por favor, preencha todos os campos!');
                return;
            }

            showScreen('personalizationScreen');
        }

        function setupPersonalization() {
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.avatar-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedAvatar = this.dataset.avatar;
                });
            });

            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.theme-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedTheme = this.dataset.theme;
                    applyTheme(selectedTheme);
                });
            });
        }

        function applyTheme(theme) {
            document.body.className = '';
            if (theme !== 'default') {
                document.body.classList.add(`theme-${theme}`);
            }
        }

        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#a8e6cf', '#ff8a80'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    confetti.style.animationDuration = (3 + Math.random() * 2) + 's';
                    
                    // Formas variadas
                    if (Math.random() > 0.5) {
                        confetti.style.borderRadius = '0';
                        confetti.style.transform = 'rotate(45deg)';
                    }
                    
                    document.body.appendChild(confetti);

                    setTimeout(() => {
                        confetti.remove();
                    }, 5000);
                }, i * 30);
            }
        }

        // =================== FUNÇÕES GLOBAIS ===================

        window.toggleSound = function() {
            gameAudio.toggle();
        };

        window.toggleQuestionType = toggleQuestionType;

        // =================== INICIALIZAÇÃO ===================

        document.addEventListener('DOMContentLoaded', function() {
            console.log('QuizMania Firebase carregado!');
            setupPersonalization();
            updateConnectionStatus('connected', 'Conectado ao Firebase!');
            
            // 🎯 Verificar se entrou via QR Code
            checkForQRCodeEntry();
            
            // 🕵️‍♂️ Configurar área secreta para modo professor
            const secretArea = document.getElementById('secretArea');
            if (secretArea) {
                secretArea.addEventListener('click', secretClick);
            }
            
            // Inicializar áudio após primeira interação do usuário
            document.addEventListener('click', function() {
                gameAudio.resumeAudio();
            }, { once: true });
            
            // Atalho de teclado para professor (Ctrl + Shift + P) - alternativo
            document.addEventListener('keydown', function(event) {
                if (event.ctrlKey && event.shiftKey && event.key === 'P') {
                    event.preventDefault();
                    showScreen('createScreen');
                    updateConnectionStatus('connected', 'Modo Professor Ativado');
                }
            });
        });

    </script>
</body>
</html>